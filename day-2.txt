main/task

- name: Install Python3 and pip
  apt:
    name:
      - python3
      - python3-pip
    state: present
    update_cache: yes

    # notify handlers
  notify: 
    - restart fastapi


--
main/ handler

- name: restart fastapi
  service:
    name: "{{fastapi_service}}"
    state: restarted
    enabled: yes

----
j2

[Unit]
Description: FAstAPI demo app
After= network.target

[Service]
ExecStart=/usr/bin/python3 -m uvicorn main:app --host 0.0.0.0 --port=8000
WorkingDirectory={{ fastapi_dir }}
Restart=always
User=ubuntu

[Install]
WantedBy=multi-user.target
